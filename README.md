# HC Agent

SC HCAgent microservice

[TOC]

## Description

This repository is an SC HCAgent microservice that is used to
moinitor pod failures and raise/cease alarms accordingly.

The microservice is based on Bob with CI and release automation
pipelines as well as Helm charts and microservice design
according to ADP DR rules.

## Contact

### Jira

Create new issue on DND project with label 5GC and assign to team sigchallengers:

Report [Bug](https://eteamproject.internal.ericsson.com/secure/CreateIssue.jspa?pid=33703&amp;issuetype=10203)

### E-mail list

Send e-mail to <IXG-ChallengersTeam@ericsson.onmicrosoft.com>

## Contributing

We are an inner source project and welcome contributions.
See our [Contributing Guide](CONTRIBUTING.md) for details.

## Documentation

* [Change Log](CHANGE_LOG.md)

### CI pipeline code

This repository includes pipeline code designed to run on a Jenkins slave.

* [JenkinsfilePreCodeReview](./JenkinsfilePreCodeReview)
* [JenkinsfileDrop](./JenkinsfileDrop)
* [JenkinsfilePra](./JenkinsfilePra)

### How to run pipeline manually

You cannot execute Pipeline script locally,
since it's whole purpose is to script Jenkins.
What you can do is call the rules for each stage manually.
The requirements for doing so are [listed here](https://gerrit.ericsson.se/plugins/gitiles/adp-cicd/bob/+/HEAD/USER_GUIDE_2.0.md#Prerequisites).

### Prepare

This stage does basic git repo initialization and
makes sure that all the
[Bob dependencies](https://gerrit.ericsson.se/plugins/gitiles/adp-cicd/bob/+/master/bob2.0/)
are met for the further steps.

```sh
git clean -xdff
git submodule sync
git submodule update --init --recursive
./bob/bob --help
```

### Running the rules for a pre-codereview build

Note: to execute the k8s-test rule the KUBECONFIG environment variable
must be set that points to a kubernetes admin.conf

```sh
./bob/bob clean init-precodereview build image package
```

#### The rules explained

`clean`:

* Remove artifacts generated by previous build

`init-precodereview`:

* Generates values for version, git hash and configures the proper repository
 for development builds

`build`:

* Build and Package maven project

`image`:

* Build docker image pointing to internal repository

`package`:

* Push docker image to development repository
* Package helm chart locally for testing

### Running the rules for a commit on master manually

> **It is not recommended to do this manually.**

Set `RELEASE` environment variable to true, plus the following environment
variables needed to be set properly
`GERRIT_USERNAME`, `GERRIT_PASSWORD`, `HELM_USERNAME`,
`HELM_TOKEN`, `ARTIFACTORY_TOKEN`.
The patch set rules are complemented with `publish`.

```sh
./bob/bob clean init-drop build image package-internal publish
```
